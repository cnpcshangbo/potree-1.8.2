<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
	<link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
	<link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
</head>

<body>
	<script src="../libs/jquery/jquery-3.1.1.min.js"></script>
	<script src="../libs/spectrum/spectrum.js"></script>
	<script src="../libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="../libs/other/BinaryHeap.js"></script>
	<script src="../libs/tween/tween.min.js"></script>
	<script src="../libs/d3/d3.js"></script>
	<script src="../libs/proj4/proj4.js"></script>
	<script src="../libs/openlayers3/ol.js"></script>
	<script src="../libs/i18next/i18next.js"></script>
	<script src="../libs/jstree/jstree.js"></script>
	<script src="../libs/copc/index.js"></script>
	<script src="../build/potree/potree.js"></script>
	<script src="../libs/plasio/js/laslaz.js"></script>

	<!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
	<!-- INCLUDE SETTINGS HERE -->

	<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
		<div id="potree_render_area" style="background-image: url('../build/potree/resources/images/background.jpg');"></div>
		<div id="potree_sidebar_container"> </div>
	</div>

	<script type="module">

	import * as THREE from "../libs/three.js/build/three.module.js";

		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));

		viewer.setEDLEnabled(true);
		viewer.setFOV(60);
		viewer.setPointBudget(2_000_000);
		viewer.loadSettingsFromURL();

		viewer.setDescription("Bayonne Bridge Pier 8-9 3D point cloud from raw images");

		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_appearance").next().show();
		});

        var path = "../pointclouds/bayonne_raw/metadata.json";
		var name = "lion";

		var getQueryParam = function(name) {
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(window.location.href);
			if (!results || !results[2]) return null;
			return decodeURIComponent(results[2].replace(/\+/g, " "));
		}

        var r = getQueryParam('r');
        if (r) {
			name = r;
            var http = 'http';
            if (r.substr(0, http.length) == http) path = name;
            else path = "../pointclouds/" + name + "/ept.json";
        }

		var c = getQueryParam('c');
		Potree.loadPointCloud(path, name, function(e){
			viewer.scene.addPointCloud(e.pointcloud);

			let material = e.pointcloud.material;
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			if (c) material.activeAttributeName = c;

			viewer.fitToScreen(0.5);
		});
		{ // MEASUREMENTS
			let scene = viewer.scene;
			{ // SINGLE POINT MEASURE
				let measure = new Potree.Measure();
				measure.name = "TestPoint";
				measure.showDistances = false;
				measure.showCoordinates = true;
				measure.maxMarkers = 1;
				measure.addMarker(new THREE.Vector3(572264.6514949066, 4498560.698092791, 32.856));
				
				scene.addMeasurement(measure);
			}
		}
		{ // ANNOTATIONS
			let scene = viewer.scene;

			
			//scene.annotations.add(new Potree.Annotation({
			//	position: [572264.6514949066, 4498560.698092791, 32.856],
			//	title: "Trees",
			//	description: `Point cloud of a small section in Sorvilier, Switzerland. <br>
			//	Courtesy of sigeom.sa`
			//}));
			scene.annotations.add(new Potree.Annotation({
				title: "Actions:&nbsp;",
				position: [572264.6514949066, 4498560.698092791, 32.856],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{
				//	"icon": Potree.resourcePath + "/icons/profile.svg",
				//	"onclick": function(){
				//		for(let pointcloud of viewer.scene.pointclouds){
				//			pointcloud.material.activeAttributeName = "elevation";
				//			pointcloud.material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
				//		}
				//	}
				//},
				//{
				//	"icon": Potree.resourcePath + "/icons/rgb.png",
				//	"onclick": function(){
				//		for(let pointcloud of viewer.scene.pointclouds){
				//			pointcloud.material.activeAttributeName = "rgba";
				//			pointcloud.material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
				//		}
				//	}
				//},
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "1",
				position: [572271.929, 4498555.032, 33.533],
				cameraPosition: [572265.4701510913, 4498556.888969469, 34.160183646169145],
				cameraTarget: [572272.0182075038, 4498555.343273453, 33.53395678885194],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "2",
				position: [572272.358, 4498557.407, 33.802],
				cameraPosition: [572266.4701510913, 4498558.888969469, 34.160183646169145],
				cameraTarget: [572273.0182075038, 4498557.343273453, 33.53395678885194],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "3",
				position: [572272.867, 4498560.301, 34.069],
				cameraPosition: [572267, 4498561, 34.9],
				cameraTarget: [572273.6, 4498559.6, 34.3],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "4",
				position: [572273.411, 4498563.298, 34.741],
				cameraPosition: [572267, 4498561, 34.9],
				cameraTarget: [572273.6, 4498559.6, 34.3],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "5",
				position: [572274.010, 4498566.489, 35.459],
				cameraPosition: [572268.50, 4498566.66, 36.25],
				cameraTarget: [572275.05, 4498565.11, 35.62],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
			scene.annotations.add(new Potree.Annotation({title: "6",
				position: [572274.528, 4498569.336, 35.906],
				cameraPosition: [572268.8, 4498568.8, 36.9],
				cameraTarget: [572275.5, 4498567.46, 36.36],
				//description: `This annotation has actions that switch between elevation and color rendering modes, and open a photo.`,
				actions: [
				//{572272.358, 4498557.407, 33.802
				{
					"icon": Potree.resourcePath + "/icons/photo.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images/S1074589.JPG");
					}
				},{
					"icon": Potree.resourcePath + "/icons/profile.svg",
					"onclick": function(){
						// Open a photo here
						window.open("https://bayonneraw.boshang.online/images_out/2024-04-26_07-29-38/crackoverlay/images/S1074589.JPG");
					}
				}]
			}));
		}
	</script>
  </body>
</html>

